import css from"../css/styles.css";import html from"../../index.html";import{getItem,getUser,searchNews,searchNewsByDate}from"./api_methods";import{defaultQuery}from"./constants.js";let searchField=document.querySelector("input[type=search]"),submitBtn=document.querySelector("input[type=submit]"),mainContainer=document.querySelector("main"),newsListContainer=document.getElementById("newsList"),ulGifElement=document.getElementById("newsList").getElementsByTagName("ul"),sortByElement=document.getElementById("filter-options"),numberOfPages=document.querySelector("#show-pagination p .nofPages"),currentPage=document.querySelector("#show-pagination p .currentPage"),currentNewsFeedTotal=document.querySelector("#show-pagination p .newsFeedCount"),prevPageLoadBtn=document.querySelector("#show-pagination .pageLoadBtns #prevPageLoadBtn"),nextPageLoadBtn=document.querySelector("#show-pagination .pageLoadBtns #nextPageLoadBtn");const tagsDialogButton=document.querySelector("#sortBy p .tag-options"),cancelButton=document.querySelector("#tagsDialog #cancel"),dialog=document.getElementById("tagsDialog"),selectedTagEls=document.querySelector("#tagsDialog select"),tagValuesConfirmBtn=document.querySelector("#tagsDialog div #confirmTagsSelected"),numericFilterDialogButton=document.querySelector("#sortBy p .numericfilter-options"),numericFiltercancelButton=document.querySelector("#numericFilterDialog #cancel"),numericFilterdialog=document.getElementById("numericFilterDialog"),numericFilterPointsGt=document.querySelector("#numericFilterDialog p #pointsGt"),numericFilterPointsLt=document.querySelector("#numericFilterDialog p #pointsLt"),numericFilterCreatedAtDate=document.querySelector("#numericFilterDialog  #createdAt"),numericFilterConfirmBtn=document.querySelector("#numericFilterDialog div #confirmNumericFilter");let page=0;function clearloadingGIF(){for(let e=0;e<ulGifElement.length-1;e++)ulGifElement[e].style.backgroundImage="url()"}tagsDialogButton.addEventListener("click",(()=>{dialog.showModal()})),cancelButton.addEventListener("click",(()=>{dialog.close()})),tagValuesConfirmBtn.addEventListener("click",(()=>{[...selectedTagEls.options].filter((e=>e.selected)).map((e=>console.log(e.value))),fetchNewsHandler(paginationData),paginationData.resetPageValue(),paginationData.resetCurrentPageInnerHTMLValue()})),numericFilterDialogButton.addEventListener("click",(()=>{numericFilterdialog.showModal()})),numericFiltercancelButton.addEventListener("click",(()=>{numericFilterdialog.close()})),numericFilterConfirmBtn.addEventListener("click",(()=>{console.log(numericFilterPointsGt.value),console.log(numericFilterPointsLt.value),console.log(numericFilterCreatedAtDate.value),fetchNewsHandler(paginationData),paginationData.resetPageValue(),paginationData.resetCurrentPageInnerHTMLValue()}));const fetchNewsHandler=e=>{if(console.log("page = "+e.page),Number(searchField.value))console.log("call getItem fxn"),getItem(searchField.value).then((e=>renderUI_fetchByID(e))).catch((e=>console.log(e)));else if((numericFilterPointsGt.value>0||numericFilterPointsLt.value>0)&&""!=numericFilterCreatedAtDate.value&&selectedTagEls.options){console.log("call searchNewsByDate fxn");let t=[].push(selectedTagEls.options);searchNewsByDate()(t)(numericFilterCreatedAtDate.value)(e.page).then((e=>renderUI(e))).catch((e=>console.log(e)))}else if("string"==typeof searchField.value&&(numericFilterPointsGt.value>0||numericFilterPointsLt.value>0)&&selectedTagEls.options){console.log("call searchNews fxn");let t=[].push(selectedTagEls.options),n=numericFilterPointsGt?`points > ${numericFilterPointsGt}`:`points < ${numericFilterPointsLt}`;searchNews(searchField.value)(t)(n)(e.page).then((e=>renderUI(e))).catch((e=>console.log(e)))}else"string"==typeof searchField.value?(console.log("call searchNews fxn only String"),searchNews(searchField.value)()()(e.page).then((e=>renderUI(e))).catch((e=>console.log(e)))):(console.log("call searchNews fxn last else"),searchNews(searchField.value)()()(e.page).then((e=>renderUI(e))).catch((e=>console.log(e))))},hideDisplayDivs=()=>{for(let e=1;e<=19;e++)document.getElementById("newsObj"+e).style.display="none"},showDisplayDivs=()=>{for(let e=0;e<=19;e++)document.getElementById("newsObj"+e).style.display="block"},renderUI_fetchByID=e=>{console.log(e),hideDisplayDivs();let t=document.getElementById("newsObj0");t.innerHTML="",clearloadingGIF();const n=document.createElement("li");n.innerHTML=`ID:  ${e.newsId}`;const a=document.createElement("li");a.innerHTML=`Title: ${e.title?e.title:"Comment"}`;const r=document.createElement("li");r.innerHTML=`Author: ${e.author}`;const i=document.createElement("li");i.innerHTML=`Link: <a href=${e.url} target="_blank">Read news</a>`;const l=document.createElement("li");"comment"==e.type&&(l.innerHTML=`${e.text}`);const o=document.createElement("li");o.innerHTML=`Created At: ${e.created_at}`,t.style.border="1px solid black",t.style.listStyle="none",t.style.padding="1rem",t.style.margin="7rem",[a,n,r,i,l,o].forEach((e=>{e.style.padding="0.3rem",t.append(e)})),newsListContainer.appendChild(t),mainContainer.appendChild(newsListContainer)},renderUI=e=>{console.log(e),paginationData.getNumberOfPagesInRetrievedData(e),paginationData.setCurrentNewsFeedTotal(e),showDisplayDivs(),e.hits.map(((e,t)=>{let n=document.getElementById("newsObj"+t);n.innerHTML="",clearloadingGIF();const a=document.createElement("li");a.innerHTML=`${e.title}`;const r=document.createElement("li");r.innerHTML=`<a href=${e.url} target="_blank">Read news</a>`;const i=document.createElement("li");i.innerHTML=`Author : ${e.author}`;const l=document.createElement("li");l.innerHTML=`CreatedDate : ${e.created_at}`;const o=document.createElement("li");o.innerHTML=`Points : ${e.points}`;const s=document.createElement("li");s.innerHTML=`Comments : ${e.num_comments}`,[a,r,i,l,o,s].forEach((e=>{e.style.padding="0.3rem",n.append(e)})),n.style.border="1px solid black",n.style.listStyle="none",n.style.padding="1rem",n.style.margin="2rem",newsListContainer.appendChild(n),mainContainer.appendChild(newsListContainer)}))};let paginationData={currentPage,numberOfPages,page,currentNewsFeedTotal,incrementPageValue(){this.page<=49&&this.page++},decrementPageValue(){0!==this.page&&this.page--},getNumberOfPagesInRetrievedData(e){this.numberOfPages.innerHTML=e.nbPages,this.numberOfPages.style.marginLeft="10px"},setCurrentPage(){this.currentPage.innerHTML=this.page,this.currentPage.style.marginLeft="10px"},setCurrentNewsFeedTotal(e){this.currentNewsFeedTotal.innerHTML=e.hitsPerPage},resetPageValue(){this.page=0},resetCurrentPageInnerHTMLValue(){this.currentPage.innerHTML=this.page}};searchNews(defaultQuery)()()(paginationData.page).then((e=>renderUI(e))).catch((e=>console.log(e))),searchField.addEventListener("keydown",(e=>{"Enter"==e.key&&(fetchNewsHandler(paginationData),paginationData.resetPageValue(),paginationData.resetCurrentPageInnerHTMLValue())})),submitBtn.addEventListener("click",(()=>{fetchNewsHandler(paginationData),paginationData.resetPageValue(),paginationData.resetCurrentPageInnerHTMLValue()})),nextPageLoadBtn.addEventListener("click",(()=>{paginationData.incrementPageValue(),console.log("new page = "+paginationData.page),paginationData.setCurrentPage(),fetchNewsHandler(paginationData)})),prevPageLoadBtn.addEventListener("click",(()=>{paginationData.decrementPageValue(),console.log("new page = "+paginationData.page),paginationData.setCurrentPage(),fetchNewsHandler(paginationData)}));